import pyrebase
from flask import Flask, render_template, request 
firebaseConfig={
  "apiKey": "AIzaSyAxtx_E08rgGWigQs4BrP1us_2Kijl89jw",
  "authDomain": "okymapp-e42bb.firebaseapp.com",
  "databaseURL": "https://okymapp-e42bb-default-rtdb.firebaseio.com",
  "projectId": "okymapp-e42bb",
  "storageBucket": "okymapp-e42bb.appspot.com",
  "messagingSenderId": "147080091155",
  "appId": "1:147080091155:web:bad9f99878aea5cc1811e6",
  "measurementId": "G-NQY4L06HWM"} 

firebase=pyrebase.initialize_app(firebaseConfig)

app = Flask(__name__)
@app.route("/")
@app.route("/index",methods=["GET","POST"])
def index():
    if request.method == 'POST':
        email = request.form['user_email']
        password = request.form['user_pwd']
        try:
                auth.sign_in_with_email_and_password(email,password)
                user_info = auth.sign_in_with_email_and_password(email,password)
                account_info = auth.get_account_info(user_info['idToken'])
                if account_info['user'] and ['emailVerified'] == False:
                    verify_message = 'Por favor verifica tu correo'
                    return render_template ('index.html', umessage=verify_message)
                return render_template('home.html')
        except:
                unsuccessful = 'Por favor verifica que los datos ingresados son correctos'
                return render_template('index.html', umessage = unsuccessful)
    return render_template("index.html") 
if __name__ == "__main__":
  app.run()

@app.route("/create_account", methods=['GET','POST'])

def create_account():
  if request.method == 'POST':
    pwd0 = request.form['user_pwd0']
    pwd1 = request.form['user_pwd1']
    if pwd0 == pwd1:
      try:
        email = request.form['user_email']
        password = request.form['user_pwd1']
        new_user = auth.create_user_with_email_and_password(email,password)
        auth.send_email_verification(new_user['idToken'])
        return render_template ("verify_email.html")
      except:
        email_existente = 'Este correo ya existe'
      return render_template ("create_account.html", exist_message=email_existente)
  return render_template("create_account.html")
@app.route("/reset_password", methods=['GET','POST'])
def forgot_password():
  return render_template("reset_password.html")